<!-- Form -->
<div class="patient-form-container">
  <%= form_tag appointment_path(@session), method: :patch, local: true, class: "patient-form", id: "edit-session-form-#{Time.current.to_i}", data: { turbo: false } do %>
    <% if @session.errors.any? %>
      <div class="form-errors">
        <h3>Por favor, corrija os seguintes erros:</h3>
        <ul>
          <% @session.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="form-row">
      <div class="form-group">
        <%= label_tag :patient_id, "Paciente", class: "form-label" %>
        <%= select_tag "session[patient_id]", 
            options_from_collection_for_select(@patients, :id, :name, @session.patient_id),
            { prompt: "Selecione um paciente", class: "form-control", required: true } %>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <%= label_tag :session_date, "Data", class: "form-label" %>
        <%= date_field_tag "session[session_date]", @session.session_date, class: "form-control", required: true %>
      </div>

      <div class="form-group">
        <%= label_tag :session_type, "Tipo", class: "form-label" %>
        <%= select_tag "session[session_type]", 
            options_for_select([
              ['Presencial', 'presencial'],
              ['Online', 'online']
            ], @session.session_type),
            { prompt: "Selecione o tipo", class: "form-control", required: true } %>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <%= label_tag :start_time, "Hora de Início", class: "form-label" %>
        <%= time_field_tag "session[start_time]", @session.start_time, class: "form-control", required: true %>
      </div>

      <div class="form-group">
        <%= label_tag :end_time, "Hora de Fim", class: "form-label" %>
        <%= time_field_tag "session[end_time]", @session.end_time, class: "form-control", required: true %>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group full-width">
        <%= label_tag :notes, "Anotações", class: "form-label" %>
        <%= text_area_tag "session[notes]", @session.notes, 
            placeholder: "Anotações sobre a sessão...",
            rows: 4,
            class: "form-control" %>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Status de Confirmação</label>
        <div class="confirmation-badge <%= @session.confirmed? ? 'confirmed' : 'pending' %>">
          <%= @session.confirmed? ? 'Confirmada' : 'Pendente' %>
        </div>
      </div>
    </div>

    <div class="form-actions">
      <%= link_to "Cancelar", agenda_path, class: "btn-secondary" %>
      <%= link_to appointment_path(@session), method: :delete, 
          class: "btn-danger", 
          data: { confirm: 'Tem certeza que deseja excluir esta sessão?' } do %>
        Excluir
      <% end %>
      <% if @session.confirmed? %>
        <%= link_to unconfirm_appointment_path(@session), method: :patch, class: "btn-warning" do %>
          Desconfirmar
        <% end %>
      <% else %>
        <%= link_to confirm_appointment_path(@session), method: :patch, class: "btn-success" do %>
          Confirmar
        <% end %>
      <% end %>
      <%= submit_tag "Salvar", class: "btn-primary" %>
    </div>
  <% end %>
</div>
